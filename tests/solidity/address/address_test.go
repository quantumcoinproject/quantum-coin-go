package address

import (
	"crypto/rand"
	"errors"
	"fmt"
	"github.com/QuantumCoinProject/qc/accounts/abi"
	"github.com/QuantumCoinProject/qc/common"
	"github.com/QuantumCoinProject/qc/common/hexutil"
	"github.com/QuantumCoinProject/qc/consensus"
	"github.com/QuantumCoinProject/qc/consensus/mockconsensus"
	"github.com/QuantumCoinProject/qc/core"
	"github.com/QuantumCoinProject/qc/core/rawdb"
	"github.com/QuantumCoinProject/qc/core/state"
	"github.com/QuantumCoinProject/qc/core/types"
	"github.com/QuantumCoinProject/qc/core/vm"
	"github.com/QuantumCoinProject/qc/internal/ethapi"
	"github.com/QuantumCoinProject/qc/log"
	"github.com/QuantumCoinProject/qc/params"
	"github.com/QuantumCoinProject/qc/tests/solidity/address/simple"
	"math"
	"math/big"
	"strconv"
	"strings"
	"testing"
)

/*
1) solc --bin --bin-runtime --abi c:\github\quantum-coin-go\tests\solidity\address\runner.sol  -o c:\github\quantum-coin-go\tests\solidity\address
3) Copy contents of AddressChecker.bin-runtime into AddressCheckerBin variable below
4) Copy contents of Runner.bin-runtime into RunnerBin variable below
5) abigen --bin=c:\github\quantum-coin-go\tests\solidity\address\Runner.bin --abi=c:\github\quantum-coin-go\tests\solidity\address\Runner.abi --pkg=address --out=c:\github\quantum-coin-go\tests\solidity\address\runner.go

6) solc --bin --bin-runtime --abi c:\github\quantum-coin-go\tests\solidity\address\simple\simple.sol  -o c:\github\quantum-coin-go\tests\solidity\address\simple  --asm --ir
7) Copy contents of Simple.bin-runtime into SimpleBin variable below
8) abigen --bin=c:\github\quantum-coin-go\tests\solidity\address\simple\Simple.bin --abi=c:\github\quantum-coin-go\tests\solidity\address\simple\Simple.abi --pkg=simple --out=c:\github\quantum-coin-go\tests\solidity\address\simple\simple.go
*/

const AddressCheckerBin = "6080604052600436106102135760003560e01c80637e06eb7d116101185780639ad1ee10116100a0578063c84d399a1161006f578063c84d399a14610a7d578063c8c1fce714610b59578063e43252d714610ba8578063e441e11e14610be3578063fe575a8714610c1e5761021a565b80639ad1ee101461093d578063aec6722d1461098c578063b31610db146109e9578063c1756a2c14610a385761021a565b8063893d20e8116100e7578063893d20e81461079b5780638942a94e146107c65780638d201cf0146108015780638da5cb5b146108e7578063994144f3146109125761021a565b80637e06eb7d146106535780637ff52c43146106ae57806381ea4408146106fd578063831c31721461074c5761021a565b80633af32abf1161019b5780635e8e30a61161016a5780635e8e30a6146105345780635f91b0af146105855780635fc7f334146105c0578063705e22ea146105eb5780637287fc4b146106025761021a565b80633af32abf146104425780633fb5c1cb1461049357806344337ea1146104ce57806347fb0bed146105095761021a565b80631d1117c3116101e25780631d1117c314610301578063243d922014610352578063288b98971461038d57806335046722146103b857806339989a5d146104075761021a565b806312065fe01461021f57806313af40351461024a578063162790551461028557806318369a2a146102d65761021a565b3661021a57005b600080fd5b34801561022b57600080fd5b50610234610c6f565b6040518082815260200191505060405180910390f35b34801561025657600080fd5b506102836004803603602081101561026d57600080fd5b8101908080359060200190929190505050610c77565b005b34801561029157600080fd5b506102be600480360360208110156102a857600080fd5b8101908080359060200190929190505050610d0a565b60405180821515815260200191505060405180910390f35b3480156102e257600080fd5b506102eb610d1d565b6040518082815260200191505060405180910390f35b34801561030d57600080fd5b5061033a6004803603602081101561032457600080fd5b8101908080359060200190929190505050610d23565b60405180821515815260200191505060405180910390f35b34801561035e57600080fd5b5061038b6004803603602081101561037557600080fd5b8101908080359060200190929190505050610d79565b005b34801561039957600080fd5b506103a2610e1c565b6040518082815260200191505060405180910390f35b3480156103c457600080fd5b506103f1600480360360208110156103db57600080fd5b8101908080359060200190929190505050610e22565b6040518082815260200191505060405180910390f35b34801561041357600080fd5b506104406004803603602081101561042a57600080fd5b8101908080359060200190929190505050610e2d565b005b34801561044e57600080fd5b5061047b6004803603602081101561046557600080fd5b8101908080359060200190929190505050610eca565b60405180821515815260200191505060405180910390f35b34801561049f57600080fd5b506104cc600480360360208110156104b657600080fd5b8101908080359060200190929190505050610ef4565b005b3480156104da57600080fd5b50610507600480360360208110156104f157600080fd5b8101908080359060200190929190505050610f36565b005b34801561051557600080fd5b5061051e610f65565b6040518082815260200191505060405180910390f35b34801561054057600080fd5b5061056d6004803603602081101561055757600080fd5b8101908080359060200190929190505050610f9a565b60405180821515815260200191505060405180910390f35b34801561059157600080fd5b506105be600480360360208110156105a857600080fd5b8101908080359060200190929190505050610fa7565b005b3480156105cc57600080fd5b506105d561104e565b6040518082815260200191505060405180910390f35b3480156105f757600080fd5b5061060061105b565b005b34801561060e57600080fd5b5061063b6004803603602081101561062557600080fd5b810190808035906020019092919050505061108a565b60405180821515815260200191505060405180910390f35b34801561065f57600080fd5b506106966004803603604081101561067657600080fd5b8101908080359060200190929190803590602001909291905050506110b3565b60405180821515815260200191505060405180910390f35b3480156106ba57600080fd5b506106fb600480360360608110156106d157600080fd5b810190808035906020019092919080359060200190929190803590602001909291905050506110c0565b005b34801561070957600080fd5b506107366004803603602081101561072057600080fd5b810190808035906020019092919050505061112b565b6040518082815260200191505060405180910390f35b34801561075857600080fd5b506107856004803603602081101561076f57600080fd5b8101908080359060200190929190505050611173565b6040518082815260200191505060405180910390f35b3480156107a757600080fd5b506107b061120e565b6040518082815260200191505060405180910390f35b3480156107d257600080fd5b506107ff600480360360208110156107e957600080fd5b8101908080359060200190929190505050611218565b005b34801561080d57600080fd5b506108d16004803603604081101561082457600080fd5b81019080803590602001909291908035906020019064010000000081111561084b57600080fd5b82018360208201111561085d57600080fd5b8035906020019184600183028401116401000000008311171561087f57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f8201169050808301925050505050505091929192905050506112f5565b6040518082815260200191505060405180910390f35b3480156108f357600080fd5b506108fc61137a565b6040518082815260200191505060405180910390f35b34801561091e57600080fd5b50610927611380565b6040518082815260200191505060405180910390f35b34801561094957600080fd5b506109766004803603602081101561096057600080fd5b810190808035906020019092919050505061138d565b6040518082815260200191505060405180910390f35b34801561099857600080fd5b506109c5600480360360208110156109af57600080fd5b81019080803590602001909291905050506113b1565b60405180848152602001838152602001828152602001935050505060405180910390f35b3480156109f557600080fd5b50610a2260048036036020811015610a0c57600080fd5b8101908080359060200190929190505050611495565b6040518082815260200191505060405180910390f35b348015610a4457600080fd5b50610a7b60048036036040811015610a5b57600080fd5b8101908080359060200190929190803590602001909291905050506114b2565b005b348015610a8957600080fd5b50610b5760048036036060811015610aa057600080fd5b810190808035906020019092919080359060200190640100000000811115610ac757600080fd5b820183602082011115610ad957600080fd5b80359060200191846001830284011164010000000083111715610afb57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f820116905080830192505050505050509192919290803590602001909291905050506115f0565b005b348015610b6557600080fd5b50610b9260048036036020811015610b7c57600080fd5b8101908080359060200190929190505050611674565b6040518082815260200191505060405180910390f35b348015610bb457600080fd5b50610be160048036036020811015610bcb57600080fd5b810190808035906020019092919050505061170f565b005b348015610bef57600080fd5b50610c1c60048036036020811015610c0657600080fd5b810190808035906020019092919050505061173e565b005b348015610c2a57600080fd5b50610c5760048036036020811015610c4157600080fd5b81019080803590602001909291905050506117e3565b60405180821515815260200191505060405180910390f35b600047905090565b6000811415610cd1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260248152602001806119726024913960400191505060405180910390fd5b806005819055506005547f6151061d0afa6e844c3531aa0600543ce61f901176e99dda15fdf8d3bf1f026a60405160405180910390a250565b600080823b905060008111915050919050565b60065481565b600080600090505b600180549050811015610d6e578260018281548110610d4657fe5b90600052602060002001541415610d61576001915050610d74565b8080600101915050610d2b565b50600090505b919050565b6000811415610df0576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601a8152602001807f496e76616c6964206164647265737320616464546f417272617900000000000081525060200191505060405180910390fd5b600181908060018154018082558091505060019003906000526020600020016000909190919091505550565b60075481565b600081319050919050565b600081604051610e3c9061180d565b80828152602001915050604051809103906000f080158015610e62573d6000803e3d6000fd5b5090506008819080600181540180825580915050600190039060005260206000200160009091909190915055807f836641082a104c21a747f2896a189cda6d34502edf7de2f98afc4460d0720bfa836040518082815260200191505060405180910390a25050565b60006003600083815260200190815260200160002060009054906101000a900460ff169050919050565b80600781905550337f68b4993aa077bdfc5de8d5c1ab25c0b5b60927464096aec20321a152685af7f0826040518082815260200191505060405180910390a250565b60016004600083815260200190815260200160002060006101000a81548160ff02191690831515021790555050565b6000337f51403d670645dd8a249fd0b8489c7b68a02c74052579e085801be0c5c12f763360405160405180910390a233905090565b6000808214159050919050565b600081141561101e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601a8152602001807f496e76616c69642061646472657373206c6f674164647265737300000000000081525060200191505060405180910390fd5b807fa226db3f664042183ee0281230bba26cbf7b5057e50aee7f25a175ff45ce4d7f60405160405180910390a250565b6000600880549050905090565b337f51403d670645dd8a249fd0b8489c7b68a02c74052579e085801be0c5c12f763360405160405180910390a2565b600080600083815260200190815260200160002060009054906101000a900460ff169050919050565b6000818314905092915050565b600960405180606001604052808581526020018481526020018381525090806001815401808255809150506001900390600052602060002090600302016000909190919091506000820151816000015560208201518160010155604082015181600201555050505050565b600080823f9050827f66ee96039e2f0f92390b91e77d5ccdd893fc0829e6ec063cb5e51dc7e49ba54b826040518082815260200191505060405180910390a280915050919050565b600060088054905082106111ef576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260138152602001807f496e646578206f7574206f6620626f756e64730000000000000000000000000081525060200191505060405180910390fd5b600882815481106111fc57fe5b90600052602060002001549050919050565b6000600554905090565b600081141561128f576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260208152602001807f496e76616c6964206164647265737320616464556e697175654164647265737381525060200191505060405180910390fd5b6000600a60008381526020019081526020016000205414156112f2576001819080600181540180825580915050600190039060005260206000200160009091909190915055600180549050600a6000838152602001908152602001600020819055505b50565b600060026000848152602001908152602001600020826040518082805190602001908083835b6020831061133e578051825260208201915060208101905060208303925061131b565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902054905092915050565b60055481565b6000600180549050905090565b6008818154811061139d57600080fd5b906000526020600020016000915090505481565b60008060006009805490508410611430576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260138152602001807f496e646578206f7574206f6620626f756e64730000000000000000000000000081525060200191505060405180910390fd5b60006009858154811061143f57fe5b906000526020600020906003020160405180606001604052908160008201548152602001600182015481526020016002820154815250509050806000015181602001518260400151935093509350509193909250565b6000600a6000838152602001908152602001600020549050919050565b8047101561150b576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252605381526020018061191f6053913960600191505060405180910390fd5b6000821415611582576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260198152602001807f496e76616c696420726563697069656e7420616464726573730000000000000081525060200191505060405180910390fd5b816108fc829081150290604051600060405180830381858888f193505050501580156115b2573d6000803e3d6000fd5b5081337f10d1a5dc650a65cd6625a330078a13ee62c6ec85b36e94bdf57e4d3188ca6738836040518082815260200191505060405180910390a35050565b8060026000858152602001908152602001600020836040518082805190602001908083835b602083106116385780518252602082019150602081019050602083039250611615565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902081905550505050565b600060018054905082106116f0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260138152602001807f496e646578206f7574206f6620626f756e64730000000000000000000000000081525060200191505060405180910390fd5b600182815481106116fd57fe5b90600052602060002001549050919050565b60016003600083815260200190815260200160002060006101000a81548160ff02191690831515021790555050565b60008114156117b5576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601c8152602001807f496e76616c6964206164647265737320616464546f4d617070696e670000000081525060200191505060405180910390fd5b600160008083815260200190815260200160002060006101000a81548160ff02191690831515021790555050565b60006004600083815260200190815260200160002060009054906101000a900460ff169050919050565b6101048061181b8339019056fe608060405234801561001057600080fd5b506040516101043803806101048339818101604052602081101561003357600080fd5b8101908080519060200190929190505050806000819055505060aa8061005a6000396000f3fe6080604052348015600f57600080fd5b506004361060285760003560e01c80633fa4f24514602d575b600080fd5b60336049565b6040518082815260200191505060405180910390f35b6000548156fea264697066735822122015308a83fe095ec520ed3201ac3c9cd2c7ddf684272e15d05c597e995898ae2064736f6c637827302e372e362d646576656c6f702e323032352e322e31332b636f6d6d69742e34663635373333610058496e73756666696369656e742062616c616e636520696e20636f6e74726163742c206465706c6f792074686520636865636b657220636f6e74726163742077697468206174206c6561737420312065746865724e6577206f776e65722063616e6e6f7420626520746865207a65726f2061646472657373a2646970667358221220e627d5333a60c5a59a4a44a5a8207870d679dd3e02e7c7ce87aa07b213be250f64736f6c637827302e372e362d646576656c6f702e323032352e322e31332b636f6d6d69742e34663635373333610058"
const RunnerBin = "6080604052600436106102135760003560e01c80635eda713a116101185780638c46d391116100a0578063cb9ccb9c1161006f578063cb9ccb9c14610a67578063e278302614610a92578063e3d11d3f14610ae3578063e4bee36114610afa578063fa06662114610b115761021a565b80638c46d3911461095d5780638e298c96146109745780639a14254b146109c5578063c3da07c914610a165761021a565b80636c2dd5fd116100e75780636c2dd5fd1461078d5780637252ac99146107a45780638083cd721461089657806383fd7119146108d1578063882b3b9f1461090c5761021a565b80635eda713a1461067757806366b661ff146106b25780636bb4f816146107015780636bc29816146107525761021a565b80634067f3bb1161019b5780634d771e071161016a5780634d771e071461055c5780635418a61f146105ab57806357ddc7a2146105e65780635c85923e146106355780635c9ddae01461064c5761021a565b80634067f3bb1461042e578063437255d71461047d578063449caa2b146104a85780634ac0d733146104f75761021a565b80631addb339116101e25780631addb3391461031f5780631f8d3b501461037057806327b2b35d14610387578063288b9897146103d857806338cc4831146104035761021a565b80630bf3051d1461021f578063127c216d1461025a5780631332104e146102a9578063178dd34b146102e45761021a565b3661021a57005b600080fd5b34801561022b57600080fd5b506102586004803603602081101561024257600080fd5b8101908080359060200190929190505050610b60565b005b34801561026657600080fd5b506102a76004803603606081101561027d57600080fd5b81019080803590602001909291908035906020019092919080359060200190929190505050610d54565b005b3480156102b557600080fd5b506102e2600480360360208110156102cc57600080fd5b8101908080359060200190929190505050610df3565b005b3480156102f057600080fd5b5061031d6004803603602081101561030757600080fd5b8101908080359060200190929190505050610e92565b005b34801561032b57600080fd5b506103586004803603602081101561034257600080fd5b8101908080359060200190929190505050611048565b60405180821515815260200191505060405180910390f35b34801561037c57600080fd5b5061038561115d565b005b34801561039357600080fd5b506103c0600480360360208110156103aa57600080fd5b8101908080359060200190929190505050611217565b60405180821515815260200191505060405180910390f35b3480156103e457600080fd5b506103ed6112b7565b6040518082815260200191505060405180910390f35b34801561040f57600080fd5b506104186112bd565b6040518082815260200191505060405180910390f35b34801561043a57600080fd5b5061047b6004803603606081101561045157600080fd5b810190808035906020019092919080359060200190929190803590602001909291905050506112c7565b005b34801561048957600080fd5b50610492611366565b6040518082815260200191505060405180910390f35b3480156104b457600080fd5b506104e1600480360360208110156104cb57600080fd5b81019080803590602001909291905050506113f9565b6040518082815260200191505060405180910390f35b34801561050357600080fd5b506105446004803603606081101561051a57600080fd5b81019080803590602001909291908035906020019092919080359060200190929190505050611403565b60405180821515815260200191505060405180910390f35b34801561056857600080fd5b506105a96004803603606081101561057f57600080fd5b81019080803590602001909291908035906020019092919080359060200190929190505050611567565b005b3480156105b757600080fd5b506105e4600480360360208110156105ce57600080fd5b8101908080359060200190929190505050611606565b005b3480156105f257600080fd5b5061061f6004803603602081101561060957600080fd5b810190808035906020019092919050505061167e565b6040518082815260200191505060405180910390f35b34801561064157600080fd5b5061064a611788565b005b34801561065857600080fd5b506106616119b2565b6040518082815260200191505060405180910390f35b34801561068357600080fd5b506106b06004803603602081101561069a57600080fd5b81019080803590602001909291905050506119ba565b005b3480156106be57600080fd5b506106ff600480360360608110156106d557600080fd5b81019080803590602001909291908035906020019092919080359060200190929190505050611a32565b005b34801561070d57600080fd5b5061073a6004803603602081101561072457600080fd5b8101908080359060200190929190505050611ad1565b60405180821515815260200191505060405180910390f35b34801561075e57600080fd5b5061078b6004803603602081101561077557600080fd5b8101908080359060200190929190505050611be6565b005b34801561079957600080fd5b506107a2611d81565b005b3480156107b057600080fd5b5061087e600480360360608110156107c757600080fd5b8101908080359060200190929190803590602001906401000000008111156107ee57600080fd5b82018360208201111561080057600080fd5b8035906020019184600183028401116401000000008311171561082257600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050919291929080359060200190929190505050611e43565b60405180821515815260200191505060405180910390f35b3480156108a257600080fd5b506108cf600480360360208110156108b957600080fd5b8101908080359060200190929190505050612045565b005b3480156108dd57600080fd5b5061090a600480360360208110156108f457600080fd5b8101908080359060200190929190505050612244565b005b34801561091857600080fd5b506109456004803603602081101561092f57600080fd5b8101908080359060200190929190505050612322565b60405180821515815260200191505060405180910390f35b34801561096957600080fd5b506109726123c2565b005b34801561098057600080fd5b506109ad6004803603602081101561099757600080fd5b810190808035906020019092919050505061248c565b60405180821515815260200191505060405180910390f35b3480156109d157600080fd5b506109fe600480360360208110156109e857600080fd5b81019080803590602001909291905050506125a1565b60405180821515815260200191505060405180910390f35b348015610a2257600080fd5b50610a4f60048036036020811015610a3957600080fd5b8101908080359060200190929190505050612641565b60405180821515815260200191505060405180910390f35b348015610a7357600080fd5b50610a7c612756565b6040518082815260200191505060405180910390f35b348015610a9e57600080fd5b50610acb60048036036020811015610ab557600080fd5b810190808035906020019092919050505061275e565b60405180821515815260200191505060405180910390f35b348015610aef57600080fd5b50610af86127fe565b005b348015610b0657600080fd5b50610b0f61355f565b005b348015610b1d57600080fd5b50610b4a60048036036020811015610b3457600080fd5b8101908080359060200190929190505050613cd5565b6040518082815260200191505060405180910390f35b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166381ea4408836040518263ffffffff1660e01b815260040180828152602001915050602060405180830381600087803b158015610bc057600080fd5b505af1158015610bd4573d6000803e3d6000fd5b505050506040513d6020811015610bea57600080fd5b810190808051906020019092919050505090506000801b811415610cae577f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf67206040518080602001806020018381038352600c8152602001807f74657374436f6465486173680000000000000000000000000000000000000000815250602001838103825260068152602001807f4661696c656400000000000000000000000000000000000000000000000000008152506020019250505060405180910390a1610d50565b7f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf67206040518080602001806020018381038352600c8152602001807f74657374436f6465486173680000000000000000000000000000000000000000815250602001838103825260078152602001807f53756363657373000000000000000000000000000000000000000000000000008152506020019250505060405180910390a15b5050565b6000831415610dae576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526029815260200180613e146029913960400191505060405180910390fd5b826000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055508160028190555080600381905550610dee61115d565b505050565b6000811415610e4d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526029815260200180613e8f6029913960400191505060405180910390fd5b806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550610e7f61355f565b610e876127fe565b610e8f611788565b50565b60003090507e494e7c4dab1532eb8dcec5bfad9d4979e7c3dca2f49209e065c10bedd7443d60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1631476040518080602001848152602001838152602001828103825260128152602001807f4265666f7265205472616e73616374696f6e0000000000000000000000000000815250602001935050505060405180910390a160008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1663c1756a2c82846040518363ffffffff1660e01b81526004018083815260200182815260200192505050600060405180830381600087803b158015610f9457600080fd5b505af1158015610fa8573d6000803e3d6000fd5b505050507e494e7c4dab1532eb8dcec5bfad9d4979e7c3dca2f49209e065c10bedd7443d60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1631476040518080602001848152602001838152602001828103825260118152602001807f4166746572205472616e73616374696f6e000000000000000000000000000000815250602001935050505060405180910390a15050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1663e43252d7836040518263ffffffff1660e01b815260040180828152602001915050600060405180830381600087803b1580156110a857600080fd5b505af11580156110bc573d6000803e3d6000fd5b5050505060008054906101000a900473ffffffffffffffffffffffffffffffffffffffff16633af32abf836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b15801561111b57600080fd5b505afa15801561112f573d6000803e3d6000fd5b505050506040513d602081101561114557600080fd5b81019080805190602001909291905050509050919050565b6000670de0b6b3a7640000905061117381610e92565b7f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf67206040518080602001806020018381038352600d8152602001807f7465737453656e64457468657200000000000000000000000000000000000000815250602001838103825260078152602001807f53756363657373000000000000000000000000000000000000000000000000008152506020019250505060405180910390a150565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166316279055836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b15801561127557600080fd5b505afa158015611289573d6000803e3d6000fd5b505050506040513d602081101561129f57600080fd5b81019080805190602001909291905050509050919050565b60015481565b6000600254905090565b6000831415611321576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526029815260200180613deb6029913960400191505060405180910390fd5b826000806101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555081600281905550806003819055506113616127fe565b505050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1663893d20e86040518163ffffffff1660e01b815260040160206040518083038186803b1580156113b957600080fd5b505afa1580156113cd573d6000803e3d6000fd5b505050506040513d60208110156113e357600080fd5b8101908080519060200190929190505050905090565b6000819050919050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16637ff52c438585856040518463ffffffff1660e01b8152600401808481526020018381526020018281526020019350505050600060405180830381600087803b15801561147357600080fd5b505af1158015611487573d6000803e3d6000fd5b5050505060008060008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1663aec6722d60006040518263ffffffff1660e01b81526004018082815260200191505060606040518083038186803b1580156114ed57600080fd5b505afa158015611501573d6000803e3d6000fd5b505050506040513d606081101561151757600080fd5b81019080805190602001909291908051906020019092919080519060200190929190505050925092509250868314801561155057508582145b801561155b57508481145b93505050509392505050565b60008314156115c1576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526029815260200180613e3d6029913960400191505060405180910390fd5b826000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055508160028190555080600381905550611601611788565b505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff166339989a5d826040518263ffffffff1660e01b815260040180828152602001915050600060405180830381600087803b15801561166357600080fd5b505af1158015611677573d6000803e3d6000fd5b5050505050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166313af4035836040518263ffffffff1660e01b815260040180828152602001915050600060405180830381600087803b1580156116de57600080fd5b505af11580156116f2573d6000803e3d6000fd5b5050505060008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1663893d20e86040518163ffffffff1660e01b815260040160206040518083038186803b15801561174657600080fd5b505afa15801561175a573d6000803e3d6000fd5b505050506040513d602081101561177057600080fd5b81019080805190602001909291905050509050919050565b6117b160008054906101000a900473ffffffffffffffffffffffffffffffffffffffff16610b60565b6117bb6001611606565b7f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf6720604051808060200180602001838103835260158152602001807f746573744465706c6f794e6577436f6e74726163740000000000000000000000815250602001838103825260078152602001807f53756363657373000000000000000000000000000000000000000000000000008152506020019250505060405180910390a16118646123c2565b7f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf67206040518080602001806020018381038352601d8152602001807f746573744765744465706c6f796564436f6e747261637473436f756e74000000815250602001838103825260078152602001807f53756363657373000000000000000000000000000000000000000000000000008152506020019250505060405180910390a161190f6000612244565b7f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf6720604051808060200180602001838103835260178152602001807f746573744765744465706c6f796564436f6e7472616374000000000000000000815250602001838103825260078152602001807f53756363657373000000000000000000000000000000000000000000000000008152506020019250505060405180910390a1565b600030905090565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff16635f91b0af826040518263ffffffff1660e01b815260040180828152602001915050600060405180830381600087803b158015611a1757600080fd5b505af1158015611a2b573d6000803e3d6000fd5b5050505050565b6000831415611a8c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526029815260200180613e666029913960400191505060405180910390fd5b826000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055508160028190555080600381905550611acc61355f565b505050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166344337ea1836040518263ffffffff1660e01b815260040180828152602001915050600060405180830381600087803b158015611b3157600080fd5b505af1158015611b45573d6000803e3d6000fd5b5050505060008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1663fe575a87836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b158015611ba457600080fd5b505afa158015611bb8573d6000803e3d6000fd5b505050506040513d6020811015611bce57600080fd5b81019080805190602001909291905050509050919050565b6000816040516024016040516020818303038152906040527f705e22ea000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040518082805190602001908083835b60208310611c9f5780518252602082019150602081019050602083039250611c7c565b6001836020036101000a0380198251168184511680821785525050505050509050019150506000604051808303816000865af19150503d8060008114611d01576040519150601f19603f3d011682016040523d82523d6000602084013e611d06565b606091505b5050905080611d7d576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260138152602001807f416464726573732063616c6c206661696c65640000000000000000000000000081525060200191505060405180910390fd5b5050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166347fb0bed6040518163ffffffff1660e01b8152600401602060405180830381600087803b158015611dd657600080fd5b505af1158015611dea573d6000803e3d6000fd5b505050506040513d6020811015611e0057600080fd5b81019080805190602001909291905050509050807fb7dd7e5499cc80c9e84312f64339a5b8f6a9b544849cb8fe6ef9b52e0d470f0160405160405180910390a250565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1663c84d399a8585856040518463ffffffff1660e01b81526004018084815260200180602001838152602001828103825284818151815260200191508051906020019080838360005b83811015611eca578082015181840152602081019050611eaf565b50505050905090810190601f168015611ef75780820380516001836020036101000a031916815260200191505b50945050505050600060405180830381600087803b158015611f1857600080fd5b505af1158015611f2c573d6000803e3d6000fd5b5050505060008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16638d201cf086866040518363ffffffff1660e01b81526004018083815260200180602001828103825283818151815260200191508051906020019080838360005b83811015611fb0578082015181840152602081019050611f95565b50505050905090810190601f168015611fdd5780820380516001836020036101000a031916815260200191505b50935050505060206040518083038186803b158015611ffb57600080fd5b505afa15801561200f573d6000803e3d6000fd5b505050506040513d602081101561202557600080fd5b810190808051906020019092919050505090508281149150509392505050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1682604051602401808281526020019150506040516020818303038152906040527f3fb5c1cb000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040518082805190602001908083835b6020831061212a5780518252602082019150602081019050602083039250612107565b6001836020036101000a038019825116818451168082178552505050505050905001915050600060405180830381855af49150503d806000811461218a576040519150601f19603f3d011682016040523d82523d6000602084013e61218f565b606091505b5050905080612206576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260138152602001807f44656c656761746563616c6c206661696c65640000000000000000000000000081525060200191505060405180910390fd5b337f53d3a45b4f407191100b855ab09b34d1ea01668a1429d379fc2e3a667015fb986001546040518082815260200191505060405180910390a25050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1663831c3172836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b1580156122a257600080fd5b505afa1580156122b6573d6000803e3d6000fd5b505050506040513d60208110156122cc57600080fd5b810190808051906020019092919050505090507fc60171353e00c574bca7a08d6842627b00d33955f090302a6b66ea22b32392c38282604051808381526020018281526020019250505060405180910390a15050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16637287fc4b836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b15801561238057600080fd5b505afa158015612394573d6000803e3d6000fd5b505050506040513d60208110156123aa57600080fd5b81019080805190602001909291905050509050919050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16635fc7f3346040518163ffffffff1660e01b815260040160206040518083038186803b15801561241557600080fd5b505afa158015612429573d6000803e3d6000fd5b505050506040513d602081101561243f57600080fd5b810190808051906020019092919050505090507f449eadc90283bbfaf710e4c1a174677bd307cbdae64eb8f02c7ed34760a8c185816040518082815260200191505060405180910390a150565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1663243d9220836040518263ffffffff1660e01b815260040180828152602001915050600060405180830381600087803b1580156124ec57600080fd5b505af1158015612500573d6000803e3d6000fd5b5050505060008054906101000a900473ffffffffffffffffffffffffffffffffffffffff16631d1117c3836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b15801561255f57600080fd5b505afa158015612573573d6000803e3d6000fd5b505050506040513d602081101561258957600080fd5b81019080805190602001909291905050509050919050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16631d1117c3836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b1580156125ff57600080fd5b505afa158015612613573d6000803e3d6000fd5b505050506040513d602081101561262957600080fd5b81019080805190602001909291905050509050919050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1663e441e11e836040518263ffffffff1660e01b815260040180828152602001915050600060405180830381600087803b1580156126a157600080fd5b505af11580156126b5573d6000803e3d6000fd5b5050505060008054906101000a900473ffffffffffffffffffffffffffffffffffffffff16637287fc4b836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b15801561271457600080fd5b505afa158015612728573d6000803e3d6000fd5b505050506040513d602081101561273e57600080fd5b81019080805190602001909291905050509050919050565b600047905090565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16635e8e30a6836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b1580156127bc57600080fd5b505afa1580156127d0573d6000803e3d6000fd5b505050506040513d60208110156127e657600080fd5b81019080805190602001909291905050509050919050565b61282760008054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611be6565b7f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf67206040518080602001806020018381038352600f8152602001807f746573744164647265737343616c6c0000000000000000000000000000000000815250602001838103825260078152602001807f53756363657373000000000000000000000000000000000000000000000000008152506020019250505060405180910390a16128d2600a612045565b7f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf6720604051808060200180602001838103835260108152602001807f7465737444656c656761746543616c6c00000000000000000000000000000000815250602001838103825260078152602001807f53756363657373000000000000000000000000000000000000000000000000008152506020019250505060405180910390a1600061298060035461275e565b90507f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf6720816129e3576040518060400160405280600781526020017f496e76616c696400000000000000000000000000000000000000000000000000815250612a1a565b6040518060400160405280600581526020017f56616c69640000000000000000000000000000000000000000000000000000008152505b604051808060200180602001838103835260138152602001807f7465737456616c69646174654164647265737300000000000000000000000000815250602001838103825284818151815260200191508051906020019080838360005b83811015612a92578082015181840152602081019050612a77565b50505050905090810190601f168015612abf5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a16000612ada600254613cd5565b90507f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf672060008211612b40576040518060400160405280600781526020017f4661696c75726500000000000000000000000000000000000000000000000000815250612b77565b6040518060400160405280600781526020017f53756363657373000000000000000000000000000000000000000000000000008152505b604051808060200180602001838103835260118152602001807f74657374556e6971756541646472657373000000000000000000000000000000815250602001838103825284818151815260200191508051906020019080838360005b83811015612bef578082015181840152602081019050612bd4565b50505050905090810190601f168015612c1c5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a160006040518060400160405280600781526020017f746573744b65790000000000000000000000000000000000000000000000000081525090506000602a90506000612c796002548484611e43565b90507f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf672081612cdc576040518060400160405280600781526020017f4661696c75726500000000000000000000000000000000000000000000000000815250612d13565b6040518060400160405280600781526020017f53756363657373000000000000000000000000000000000000000000000000008152505b604051808060200180602001838103835260118152602001807f746573744e65737465644d617070696e67000000000000000000000000000000815250602001838103825284818151815260200191508051906020019080838360005b83811015612d8b578082015181840152602081019050612d70565b50505050905090810190601f168015612db85780820380516001836020036101000a031916815260200191505b50935050505060405180910390a16000612dd3600254611048565b90507f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf672081612e36576040518060400160405280600f81526020017f4e6f742057686974656c69737465640000000000000000000000000000000000815250612e6d565b6040518060400160405280600b81526020017f57686974656c69737465640000000000000000000000000000000000000000008152505b6040518080602001806020018381038352600d8152602001807f7465737457686974656c69737400000000000000000000000000000000000000815250602001838103825284818151815260200191508051906020019080838360005b83811015612ee5578082015181840152602081019050612eca565b50505050905090810190601f168015612f125780820380516001836020036101000a031916815260200191505b50935050505060405180910390a16000612f2d600354611ad1565b90507f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf672081612f90576040518060400160405280600f81526020017f4e6f7420426c61636b6c69737465640000000000000000000000000000000000815250612fc7565b6040518060400160405280600b81526020017f426c61636b6c69737465640000000000000000000000000000000000000000008152505b6040518080602001806020018381038352600d8152602001807f74657374426c61636b6c69737400000000000000000000000000000000000000815250602001838103825284818151815260200191508051906020019080838360005b8381101561303f578082015181840152602081019050613024565b50505050905090810190601f16801561306c5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a16130856003546119ba565b7f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf67206040518080602001806020018381038352600e8152602001807f746573744c6f6741646472657373000000000000000000000000000000000000815250602001838103825260138152602001807f4c6f67676564205375636365737366756c6c79000000000000000000000000008152506020019250505060405180910390a16000613133600254611217565b90507f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf672081613196576040518060400160405280600f81526020017f4973204e6f7420436f6e747261637400000000000000000000000000000000008152506131cd565b6040518060400160405280600b81526020017f497320436f6e74726163740000000000000000000000000000000000000000008152505b6040518080602001806020018381038352601b8152602001807f746573744973436f6e7472616374207465737441646472657373310000000000815250602001838103825284818151815260200191508051906020019080838360005b8381101561324557808201518184015260208101905061322a565b50505050905090810190601f1680156132725780820380516001836020036101000a031916815260200191505b50935050505060405180910390a16132a960008054906101000a900473ffffffffffffffffffffffffffffffffffffffff16611217565b90507f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf67208161330c576040518060400160405280600f81526020017f4973204e6f7420436f6e74726163740000000000000000000000000000000000815250613343565b6040518060400160405280600b81526020017f497320436f6e74726163740000000000000000000000000000000000000000008152505b6040518080602001806020018381038352601d8152602001807f746573744973436f6e74726163742061646472657373436865636b6572000000815250602001838103825284818151815260200191508051906020019080838360005b838110156133bb5780820151818401526020810190506133a0565b50505050905090810190601f1680156133e85780820380516001836020036101000a031916815260200191505b50935050505060405180910390a16000613407600254602a6054611403565b90507f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf67208161346a576040518060400160405280600781526020017f4661696c757265000000000000000000000000000000000000000000000000008152506134a1565b6040518060400160405280600781526020017f53756363657373000000000000000000000000000000000000000000000000008152505b604051808060200180602001838103835260108152602001807f7465737453696d706c6553747275637400000000000000000000000000000000815250602001838103825284818151815260200191508051906020019080838360005b838110156135195780820151818401526020810190506134fe565b50505050905090810190601f1680156135465780820380516001836020036101000a031916815260200191505b50935050505060405180910390a1505050505050505050565b613567611d81565b7f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf67206040518080602001806020018381038352600f8152602001807f74657374436865636b53656e6465720000000000000000000000000000000000815250602001838103825260078152602001807f53756363657373000000000000000000000000000000000000000000000000008152506020019250505060405180910390a16000613615600254612641565b90507f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf672081613678576040518060400160405280600781526020017f4661696c757265000000000000000000000000000000000000000000000000008152506136af565b6040518060400160405280600781526020017f53756363657373000000000000000000000000000000000000000000000000008152505b604051808060200180602001838103835260108152602001807f74657374416464546f4d617070696e6700000000000000000000000000000000815250602001838103825284818151815260200191508051906020019080838360005b8381101561372757808201518184015260208101905061370c565b50505050905090810190601f1680156137545780820380516001836020036101000a031916815260200191505b50935050505060405180910390a1600061376f600254612322565b90507f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf6720816137d2576040518060400160405280600781526020017f4661696c75726500000000000000000000000000000000000000000000000000815250613809565b6040518060400160405280600781526020017f53756363657373000000000000000000000000000000000000000000000000008152505b604051808060200180602001838103835260108152602001807f74657374436865636b4d617070696e6700000000000000000000000000000000815250602001838103825284818151815260200191508051906020019080838360005b83811015613881578082015181840152602081019050613866565b50505050905090810190601f1680156138ae5780820380516001836020036101000a031916815260200191505b50935050505060405180910390a160006138c960025461248c565b90507f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf67208161392c576040518060400160405280600781526020017f4661696c75726500000000000000000000000000000000000000000000000000815250613963565b6040518060400160405280600781526020017f53756363657373000000000000000000000000000000000000000000000000008152505b6040518080602001806020018381038352600e8152602001807f74657374416464546f4172726179000000000000000000000000000000000000815250602001838103825284818151815260200191508051906020019080838360005b838110156139db5780820151818401526020810190506139c0565b50505050905090810190601f168015613a085780820380516001836020036101000a031916815260200191505b50935050505060405180910390a16000613a236002546125a1565b90507f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf672081613a86576040518060400160405280600781526020017f4661696c75726500000000000000000000000000000000000000000000000000815250613abd565b6040518060400160405280600781526020017f53756363657373000000000000000000000000000000000000000000000000008152505b6040518080602001806020018381038352600e8152602001807f74657374436865636b4172726179000000000000000000000000000000000000815250602001838103825284818151815260200191508051906020019080838360005b83811015613b35578082015181840152602081019050613b1a565b50505050905090810190601f168015613b625780820380516001836020036101000a031916815260200191505b50935050505060405180910390a16000613b7d60025461167e565b90507f48e71b6d9e8347b669c55322c62efbefc185466e9ce7e1a8e48d38055ccf67206002548214613be4576040518060400160405280600781526020017f4661696c75726500000000000000000000000000000000000000000000000000815250613c1b565b6040518060400160405280600781526020017f53756363657373000000000000000000000000000000000000000000000000008152505b604051808060200180602001838103835260148152602001807f74657374536574416e64436865636b4f776e6572000000000000000000000000815250602001838103825284818151815260200191508051906020019080838360005b83811015613c93578082015181840152602081019050613c78565b50505050905090810190601f168015613cc05780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15050505050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16638942a94e836040518263ffffffff1660e01b815260040180828152602001915050600060405180830381600087803b158015613d3557600080fd5b505af1158015613d49573d6000803e3d6000fd5b5050505060008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1663b31610db836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b158015613da857600080fd5b505afa158015613dbc573d6000803e3d6000fd5b505050506040513d6020811015613dd257600080fd5b8101908080519060200190929190505050905091905056fe496e76616c69642041646472657373436865636b657220636f6e747261637420616464726573732063496e76616c69642041646472657373436865636b657220636f6e747261637420616464726573732065496e76616c69642041646472657373436865636b657220636f6e747261637420616464726573732064496e76616c69642041646472657373436865636b657220636f6e747261637420616464726573732062496e76616c69642041646472657373436865636b657220636f6e747261637420616464726573732061a2646970667358221220654757634762abd6d76fc3d213e525b3de7d371aa5785d16e3b07a6a8f7cd07064736f6c637827302e372e362d646576656c6f702e323032352e322e31332b636f6d6d69742e34663635373333610058"
const SimpleBin = "6080604052348015600f57600080fd5b506004361060285760003560e01c806338cc483114602d575b600080fd5b60336049565b6040518082815260200191505060405180910390f35b6000805490509056fea26469706673582212208a04538509eaf82efcd4b55f78e0e7e68ffd6df932764be9f9c2a51e73a5b7c764736f6c637827302e372e362d646576656c6f702e323032352e322e32312b636f6d6d69742e66353035316436350058"
const GENESIS_BLOCK_HASH = "0x2c8127f13d50434052128a88c9c9f79a27d44a1145e51f6fd250b6e247369e99"

var addressCheckerContractAddress = common.HexToAddress("0x0000000000000000000000000000000000000000000000000000000000003000")
var runnerContractAddress = common.HexToAddress("0x0000000000000000000000000000000000000000000000000000000000004000")
var messageSenderAddress = common.HexToAddress("0x0000000000000000000000000000000000000000000000000000000000005000")

var testAddress1 = common.RandomAddress()
var testAddress2 = common.RandomAddress()

func newSimpleStateDb() *state.StateDB {
	statedb, _ := state.New(common.Hash{}, state.NewDatabase(rawdb.NewMemoryDatabase()), nil)

	statedb.CreateAccount(runnerContractAddress)
	statedb.SetCode(runnerContractAddress, common.FromHex(SimpleBin))

	for i := 0; i <= 9999999; i++ {
		statedb.AddBalance(runnerContractAddress, big.NewInt(9000000000000000000))
		//statedb.AddBalance(runnerContractAddress, big.NewInt(9000000000000000000))
		//statedb.AddBalance(messageSenderAddress, big.NewInt(9000000000000000000))
	}

	statedb.Finalise(true) // Push the state into the "original" slot

	return statedb
}

func newStateDb() *state.StateDB {
	statedb, _ := state.New(common.Hash{}, state.NewDatabase(rawdb.NewMemoryDatabase()), nil)

	statedb.CreateAccount(addressCheckerContractAddress)
	statedb.SetCode(addressCheckerContractAddress, common.FromHex(AddressCheckerBin))

	statedb.CreateAccount(runnerContractAddress)
	statedb.SetCode(runnerContractAddress, common.FromHex(RunnerBin))

	for i := 0; i <= 9999999; i++ {
		statedb.AddBalance(addressCheckerContractAddress, big.NewInt(9000000000000000000))
		//statedb.AddBalance(runnerContractAddress, big.NewInt(9000000000000000000))
		//statedb.AddBalance(messageSenderAddress, big.NewInt(9000000000000000000))
	}

	statedb.Finalise(true) // Push the state into the "original" slot

	return statedb
}

// largeNumber returns a very large big.Int.
func largeNumber(megabytes int) *big.Int {
	buf := make([]byte, megabytes*1024*1024)
	rand.Read(buf)
	bigint := new(big.Int)
	bigint.SetBytes(buf)
	return bigint
}

type TestChainContext struct {
	Eng consensus.Engine
}

func (tcc *TestChainContext) Engine() consensus.Engine {
	return tcc.Eng
}

func (tcc *TestChainContext) GetHeader(lastKnownHash common.Hash, lastKnownNumber uint64) *types.Header {
	hash := common.BytesToHash([]byte(strconv.FormatUint(lastKnownNumber+1, 10)))
	blockNumber := big.NewInt(int64(lastKnownNumber + 1))

	header := &types.Header{
		MixDigest:   hash,
		ReceiptHash: hash,
		TxHash:      hash,
		Nonce:       types.BlockNonce{},
		Extra:       []byte{},
		Bloom:       types.Bloom{},
		GasUsed:     0,
		Coinbase:    common.Address{},
		GasLimit:    0,
		Time:        1337,
		ParentHash:  lastKnownHash,
		Root:        hash,
		Number:      blockNumber,
		Difficulty:  largeNumber(2),
	}

	return header
}

var chainConfig = &params.ChainConfig{
	ChainID:             big.NewInt(1),
	HomesteadBlock:      new(big.Int),
	EIP155Block:         new(big.Int),
	EIP150Block:         new(big.Int),
	EIP158Block:         new(big.Int),
	ByzantiumBlock:      new(big.Int),
	ConstantinopleBlock: new(big.Int),
	PetersburgBlock:     new(big.Int),
	IstanbulBlock:       new(big.Int),
	BerlinBlock:         new(big.Int),
	LondonBlock:         new(big.Int),
}

var engine = mockconsensus.New(chainConfig, nil, common.HexToHash(GENESIS_BLOCK_HASH))

var tcc = &TestChainContext{Eng: engine}

func execute(tcc *TestChainContext, data []byte, from common.Address, state *state.StateDB, header *types.Header, value *big.Int) (hexutil.Bytes, error) {
	msgData := (hexutil.Bytes)(data)

	args := ethapi.TransactionArgs{
		From:  &from,
		To:    &runnerContractAddress,
		Data:  &msgData,
		Value: (*hexutil.Big)(value),
	}

	msg, err := args.ToMessage(math.MaxUint64)
	if err != nil {
		return nil, err
	}

	vmError := func() error { return nil }
	vmConfig := &vm.Config{OverrideGasFailure: true}

	txContext := core.NewEVMTxContext(msg)
	context := core.NewEVMBlockContext(header, tcc, nil)
	evm := vm.NewEVM(context, txContext, state, chainConfig, *vmConfig)

	gp := new(core.GasPool).AddGas(math.MaxUint64)
	result, err := core.ApplyMessage(evm, msg, gp)
	if err != nil {
		return nil, err
	}

	if err = vmError(); err != nil {
		return nil, err
	}

	if result == nil {
		return nil, errors.New("result is nil")
	}

	// If the result contains a revert reason, try to unpack and return it.
	if len(result.Revert()) > 0 {
		return nil, core.NewRevertError(result)
	}
	return result.Return(), result.Err
}

func encodeCall(abi *abi.ABI, method string, args ...interface{}) ([]byte, error) {
	return abi.Pack(method, args...)
}

func GetRunner_ABI() (abi.ABI, error) {
	s := AddressMetaData.ABI
	abi, err := abi.JSON(strings.NewReader(s))
	return abi, err
}

func GetSimple_ABI() (abi.ABI, error) {
	s := simple.AddressMetaData.ABI
	abi, err := abi.JSON(strings.NewReader(s))
	return abi, err
}

func runAllTestsWithDefaultAddress(state *state.StateDB) error {
	method := "runAllTestsWithDefaultAddress"
	abiData, err := GetRunner_ABI()
	if err != nil {
		log.Error("runAllTestsWithDefaultAddress abi error", "err", err)
		return err
	}
	// call
	data, err := encodeCall(&abiData, method, addressCheckerContractAddress)
	if err != nil {
		log.Error("Unable to pack runAllTestsWithDefaultAddress", "error", err)
		return err
	}

	header := tcc.GetHeader(common.ZERO_HASH, uint64(1))

	_, err = execute(tcc, data, messageSenderAddress, state, header, new(big.Int))
	if err != nil {
		log.Error("Unable to execute", "error", err)
		return err
	}

	return nil
}

func getAddressTest(state *state.StateDB) error {
	method := "getAddress"
	abiData, err := GetSimple_ABI()
	if err != nil {
		log.Error("getAddressTest abi error", "err", err)
		return err
	}
	// call
	data, err := encodeCall(&abiData, method)
	if err != nil {
		log.Error("Unable to pack getAddressTest", "error", err)
		return err
	}

	header := tcc.GetHeader(common.ZERO_HASH, uint64(1))

	result, err := execute(tcc, data, messageSenderAddress, state, header, new(big.Int))
	if err != nil {
		log.Error("Unable to execute", "error", err)
		return err
	}

	if len(result) == 0 {
		return errors.New("getAddressTest result is 0")
	}

	var (
		outAddr = new(common.Address)
	)

	if err = abiData.UnpackIntoInterface(&outAddr, method, result); err != nil {
		log.Error("getAddressTest UnpackIntoInterface", "err", err, "address", outAddr)
	}

	expectedAddr := common.HexToAddress("0xa000000000000000000000000000000000000000000000000000000000001000")
	if expectedAddr.IsEqualTo(*outAddr) == false {
		fmt.Println("getAddressTest", "expected", expectedAddr, "got", *outAddr)
		return errors.New("unexpected address")
	}

	return nil
}

func getInputAddressTest(state *state.StateDB, expectedAddr common.Address) error {
	method := "getInputAddress"
	abiData, err := GetRunner_ABI()
	if err != nil {
		log.Error("getInputAddressTest abi error", "err", err)
		return err
	}
	// call
	data, err := encodeCall(&abiData, method, expectedAddr)
	if err != nil {
		log.Error("Unable to pack getInputAddressTest", "error", err)
		return err
	}

	header := tcc.GetHeader(common.ZERO_HASH, uint64(1))

	result, err := execute(tcc, data, messageSenderAddress, state, header, new(big.Int))
	if err != nil {
		log.Error("Unable to execute", "error", err)
		return err
	}

	if len(result) == 0 {
		return errors.New("getInputAddressTest result is 0")
	}

	var (
		outAddr = new(common.Address)
	)

	if err = abiData.UnpackIntoInterface(&outAddr, method, result); err != nil {
		log.Error("getInputAddressTest UnpackIntoInterface", "err", err, "address", outAddr)
	}

	if expectedAddr.IsEqualTo(*outAddr) == false {
		fmt.Println("getInputAddressTest", "expected", expectedAddr, "got", *outAddr)
		return errors.New("unexpected address")
	}

	return nil
}

func runAllTests(state *state.StateDB, method string) error {
	abiData, err := GetRunner_ABI()
	if err != nil {
		log.Error("runAllTests abi error", "err", err)
		return err
	}
	// call
	data, err := encodeCall(&abiData, method, addressCheckerContractAddress, testAddress1, testAddress2)
	if err != nil {
		log.Error("Unable to pack runAllTests", "error", err)
		return err
	}

	header := tcc.GetHeader(common.ZERO_HASH, uint64(1))

	_, err = execute(tcc, data, messageSenderAddress, state, header, new(big.Int))
	if err != nil {
		return err
	}

	return nil
}

func TestSuite(t *testing.T) {
	sdb := newStateDb()

	var err error

	err = runAllTestsWithDefaultAddress(sdb)
	if err != nil {
		fmt.Println("runAllTestsWithDefaultAddress error", "failed", err)
		//t.Fatalf("runAllTestsWithDefaultAddress failed") //todo: fix
	}

	err = runAllTests(sdb, "runAllTests1")
	if err != nil {
		fmt.Println("runAllTests1 error", "failed", err)
		t.Fatalf("runAllTests1 failed")
	}

	err = runAllTests(sdb, "runAllTests2")
	if err != nil {
		fmt.Println("runAllTests2 error", "failed", err)
		t.Fatalf("runAllTests2 failed")
	}

	err = runAllTests(sdb, "runAllTests4")
	if err != nil {
		fmt.Println("runAllTests4 error", "failed", err)
		t.Fatalf("runAllTests4 failed")
	}

	err = runAllTests(sdb, "runAllTests3")
	if err != nil {
		fmt.Println("runAllTests3 error", "failed", err)
		//t.Fatalf("runAllTests3 failed") //todo: fix
	}

}

func TestGetInputAddress(t *testing.T) {
	var err error
	sdb := newStateDb()

	err = getInputAddressTest(sdb, common.HexToAddress("0xa000000000000000000000000000000000000000000000000000000000001000"))
	if err != nil {
		fmt.Println(err)
		t.Fatalf("failed 1")
	}
}

func TestGetAddress(t *testing.T) {
	var err error
	sdb := newSimpleStateDb()

	err = getAddressTest(sdb)
	if err != nil {
		fmt.Println(err)
		t.Fatalf("failed 2")
	}
}
